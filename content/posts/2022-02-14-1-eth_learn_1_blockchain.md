---
layout: post
title: 以太坊开发（一）区块链基础知识
tags:
  - eth
description: 区块链基础概念
image: /images/eth_learn/eth.webp
redirect_from:
  - /gbk-or-utf8/
  - /gbk-or-utf8
noComments: false
---

>> 以太坊开发（一）区块链基础知识

## 一、区块链基本概念
### 1. 区块链：
> 一句话简述区块链: 基于共识机制、去中心化的"数据库"。

  - 区块链是由不特定的节点（计算机）组成的计算机分布式网络，通过共识算法和机制保证区块链和数据的分布式一致性，从而形成一个统一的分布式账本。
  - 最早的区块链系统是BTC ,BTC是一个: 
    - 基于比特币协议（写入代码）、
    - 不需要许可的分布式"数据库"。
    - 这个系统维护了一个持续增长、不可篡改的数据记录集合
    - 该集合可能有分叉，但以最长分叉的数据链条为准。
    - 这些数据以块的数据结构存储，块称为block，
    - 这些块的组织方式是个链式结构，所以就称为blockchain（区块链）
    - 区块链/BTC是时间的机器：以BTC为例，区块链中的数据和信用，被记录在链中，自带时间戳，数据和时间戳都不能被改变，所以又称区块链是时间的机器、信任的机器。
    - 用户访问账本，需要用到公私钥。
      * 私钥用户控制，对外不可见。 （千万不能对外暴露，同时要做好物理备份）
      * 公钥对外公开，代表用户（例如可作为收账的公开地址，别的人可以向这个地址转账）
      * 私钥可以恢复出公钥，反之则不行
  - 区块链系统主要特点：
    * 分布式 （Distrubuted）
    * 自治的 （Autonomous）：主要指公链，所有用户可自由加入或推出，无审核批准机制，只要遵照代码规定的合约执行就OK。
    * 合约化 （code is law）：合约化，有两层含义，一层是公链的规则代码化（例如代码规定了挖矿规则，记账规则）。二是区块链上的上层应用的合约化，规则化，即常说的Dapp应用，该应用将业务规则抽象成自动执行的合约代码，这些dapp排除了人为干预的可能，自动按用户规定的业务逻辑、规则运行。
    * 可追溯 （public）：区块链数据公开（***注意，包含公钥的交易数据，处理数据公开，但私钥用户掌握，永远不公开***），数据公开，则所有交易数据都可查，且自带可信时间戳。
    
### 2. 共识机制：
> 分布式系统中，保证数据一致性的算法。

  - CAP原理：分布式系统很难设计、效率也很难提升，最主要的是受限于cap原理，这个原理经证明，可以认为是分布式系统的公理，不可改变。详细解释参考百度：[百度百科-CAP原则](https://baike.baidu.com/item/CAP%E5%8E%9F%E5%88%99/5712863)
### 3. 去中心化：
> 参与区块链的节点（计算机）权力对等，没有管理员审核，自由出入系统，按照统一的、预先设定的规则（代码），平等自由的参与网络。

  - 每个参与的节点（计算机）都有一份数据copy，同时有共识机制算法来保证所有机器上的数据一致性，从而保证了数据的安全
  - 公链：尽量遵循去中心化的原则，强去中心化。
  - 联盟链：一般有管理节点和单位，弱去中心化。
  - 私链：不太想说这个。
### 4. 价值互联网：
> 传统互联网传递消息，区块链网络由于加入了所有权，以及所有权的转移，升级成为价值互联网。

  - 举个例子，传统网络你写个文章，其他人可以copy，成为他的文章。区块链中你可以签名这篇文章内容，同时加入有效的时间戳，没有人可以更改这些信息，从而证明你拥有这个文章的最先发布证明（不是所有证明，证明属于你所有，还需要另外的机制保证--例如发布到区块链中，同时发布一个法律声明，证明本人保证自己原创，愿意承担所有法律后果等，以后再讨论）
  - 发布证明之后，你可以对这个权属进行转让。（例如锻造成一个NFT，交易后，转让出所有权）

## 二、 BTC基本概念
> BTC是最早的区块链系统，它打下了区块链的基础，是整个区块链世界的基石。这里简单列举BTC的基本概念

### 1. 比特币地址。 
  比特币私钥可生成公钥，而比特币地址就是公钥通过hash算法推导出的一个字符串。比特币地址可以类比成你家的门牌号，别人知道你家的地址，就可以向这个地址邮寄信件。

### 2. 交易
  用户Alice可向用户Bob发起一个交易。例如这个交易是从Alice地址转一个比特币到用户Bob。这个交易就包括了一组输入输出数据结构，这个结构包括了发起人Alice的比特币地址，接受人Bob的比特币地址，以及交易金额（来源）等信息

### 3. UTXO   
比特币是一个交易的公共账本，所有的交易输入、输出都会记录在公共的交易账本中。
现代货币系统，本质上是个记账系统。会计的复试记账也是一个伟大的发明。
比特币也创造性的采取了一种特殊的交易数据结构，称为UTXO(未使用的交易输出）。
***这个数据结构，是将一个账户“上一次收到的交易”（也可以有多个上几次未花费的、收到的交易信息）做为本次交易的输入（因此如果Alice要向Bob转5个btc，Alice可能是以前收到的三次接收记录（例如分别是1，2，3个比特币）加起来，向Bob发送5个BTC。也就是说BTC的账本，忠实的记录了每个账户的每笔收入，每笔支出，BTC账户没有一个对应的变量来保存每个账户有多少btc个数***
因为每个交易都有该交易对应的接收者公钥，以及该使用该公钥对该交易的信息进行的签名值。从而可以保证拥有该公钥对应的私钥的用户，可以使用该资金。

### 4. 交易类型
> BTC的UTXO涉及到收到的交易，以及自己发出的交易。    
> 因此会涉及到最多三个用户：Alice，Bob，Cherry.     
> 交易顺序为 Alice => Bob => Cherry.     

- 支付到公钥hash  
  * Alice => Bob用户转账, 
    * 就是Alice用Bob的公钥（这是公开的）生成该交易信息的签名值。   
    * 该签名值因为采用了非对称加密方法，所以只能用Bob的私钥进行验证。
    * 也就是说只能Bob才能动用这笔资金。    
  * Bob => Cherry
    * Bob要进行交易，即Bob到Cherry的转账，需要花费上笔从Alice收到的UTXO   
    * Bob使用自己的私钥对上次交易（即Alice => Bob)的交易数据（交易hash）进行签名，并指定接受者Cherry对应的公钥。 
    * 记账矿工进行打包时，会验证Bob签名值、上次交易hash收否匹配是否匹配，能匹配说明，是Bob这个用户在使用该笔UTXO。
    * 该记账矿工，会不会作弊呢？ 这时就涉及到共识机制了，记账矿工会将该交易打包，分发到其他矿工，其他矿工会对这个交易进行验证，验证失败会丢弃。从而保证全网数据的正确性。
- 支付到脚本  
   * 该类型不是到某一个地址，而是一个简单的脚本文件，例如该脚本包含3个地址，并且该脚本规定3个地址中的2个地址，可以动用该笔资金。这种支付方式，提供了简单的智能合约功能，但没有for/while循环，不是图灵完备的智能合约。   
   * 题外话，BTC为什么不提供图灵完备，其实是有原因的，第一可能是时间限制，来不及大规模设计开发，但最重要的是需求，对BTC系统来说，数字黄金或者数字货币是其首要的业务属性，因此提供简单的脚本系统，避免这个数字黄金系统的稳定性受到威胁，是其最重要的设计目标，BTC做到了这个目标（实际上脚本系统有些cmd，因为复杂可能威胁到安全，所以从该系统中移除掉了）

- coinbase交易   
  * 即矿工挖矿所得。
  * BTC本质上是个分布式的账本系统，为了鼓励大家贡献计算机、网络、存储等资源来维护这个全球的会计账本，BTC提供了激励机制。矿工挖矿成功，即可获得coinbase奖励。
  * coinbase 每21万个区块后会减半。最开始为50个BTC/区块，本文记录时，为12.5，下个周期从2024年开始，为6.25个BTC/区块。

>>>  注意2024年5月左右这个时间点。因为区块奖励减半将会导致BTC供应稀缺，整个市场会在这个时间点前后发生比较剧烈的波动。 
   
### 5. 找零地址   
通过以上的支付过程描述， 当Alice向Bob转帐时，是将以前收到的交易凑出需要的值来向Bob转帐，那么凑出来的数字很可能有余额（例如几笔收到的btc总数为10，需要向Bob转帐9个，则余额为1）。    
该找零地址最好设置成新地址，这样可以提高隐私安全性。但也可以不设置，这样找零将返回给原地址。   

### 6. 区块 & 区块链
BTC的区块包称为block，他们通过链式结构前后耦合在一起，所以称为blockchain。 

### 7. BTC的脚本系统 & 弱智能合约

### 8. BTC典型流程

### 9. BTC挖矿 & 矿池   

## 三、以太坊 & 以太坊智能合约

> BTC是第一个区块链应用，且是全球大规模的分布式数据一致性系统，它的设计实现了用户数字资产的可靠、安全发送和交易，从而为价值互联网打下了稳定的基础。    
* BTC是数字世界的数字黄金。未来可能会成为线上、线下的清结算层，这个工作BTC可以胜任。
* 但BTC系统由于上线较早，且由于定位强金融/货币的原因，在某些方面存在缺点和短板。复杂世界的复杂应用，BTC系统的脚本系统满足不了复杂业务逻辑的要求。
* BTC实现了数字黄金的有限可编程性，实现了非图灵完备的弱智能合约系统（脚本系统），但没有for/while循环，限制了区块链的可编程性。

> 以太坊，在应用可编程领域超越了BTC，实现了图灵完备的智能合约。 
> 因此以太坊被称为区块链2.0，并在可见的未来可能成为一个全球可信任的基础设施、一个可编程的时间信任机器。